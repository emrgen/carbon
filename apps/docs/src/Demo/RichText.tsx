import {attrRenderers} from "@emrgen/carbon-attributes";
import {blockPresetPlugins} from "@emrgen/carbon-blocks";
import {blockPresetRenderers} from "@emrgen/carbon-blocks-react";
import {FloatingStyleMenu, InsertBlockMenu} from "@emrgen/carbon-chakra-ui";
import {ClipboardPlugin} from "@emrgen/carbon-clipboard";
import {codemirrorExtension} from "@emrgen/carbon-codemirror";
import {commentEditorComp, commentEditorPlugin} from "@emrgen/carbon-comment-editor";
import {corePresetPlugins, NodeId} from "@emrgen/carbon-core";
import {databasePlugins} from "@emrgen/carbon-database";
import {databaseRenderers} from "@emrgen/carbon-database-react";
import {RenderManager} from "@emrgen/carbon-react";
import {BlockMenuPlugin, Carbon} from "@emrgen/carbon-utils";
import {noop} from "lodash";
import {useCreate} from "../create";

// console.log = noop;
// console.info = noop;
console.debug = noop;
console.warn = noop;
console.error = noop;
console.group = noop;
console.groupCollapsed = noop;
console.groupEnd = noop;
console.time = noop;

const content =
  '{"id":"999999999","name":"carbon","children":[{"id":"lzss07fbg","name":"page","children":[{"id":"33s1f2p76","name":"title","children":[{"id":"f2hfxmj49","name":"text","text":"CarbonEditor Editor","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}},{"id":"54i8rlifx","name":"paragraph","children":[{"id":"5idh90x6m","name":"title","children":[{"id":"klg4u9pek","name":"text","text":"This is a ","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[]}}}},{"id":"r20jr0g41","name":"text","text":"RichText","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[{"name":"bold"}]}}}},{"id":"cdbykiz6m","name":"text","text":" editor framework built from ","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}},{"id":"_1yjgr71ad","name":"text","text":"group up","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[{"name":"underline"}]}}}},{"id":"_pwop55tcj","name":"text","text":".","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"auzpyuysr","name":"paragraph","children":[{"id":"00i7uo2qv","name":"title","children":[{"id":"vi6uka92c","name":"text","text":"Some of features are shown below.","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"e8dhn4aqs","name":"paragraph","children":[{"id":"03yz6xd07","name":"title","children":[],"links":{},"props":{"remote":{"state":{"marks":[]}},"local":{"html":{"placeholder":""}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"jk4v74ax9","name":"h2","children":[{"id":"y5clp23ej","name":"title","children":[{"id":"q2un8zf0y","name":"text","text":"Lists","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 2","focused":"Heading 2"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"y7eavu78g","name":"h4","children":[{"id":"408w69na5","name":"title","children":[{"id":"9f178uemv","name":"text","text":"To-do List:","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 4","focused":"Heading 4"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[],"checked":false}}}},{"id":"adbyj9z2q","name":"todo","children":[{"id":"3g6ah07zx","name":"title","children":[{"id":"b3uw9h92h","name":"text","text":" Build editor core","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"To-do","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"ctdl"}},"remote":{"state":{"checked":false,"marks":[]}}}},{"id":"90jjdpauu","name":"todo","children":[{"id":"hjvzuqzke","name":"title","children":[{"id":"clom6aho0","name":"text","text":"Add markdown support","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"To-do","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"ctdl"}},"remote":{"state":{"checked":false,"marks":[]}}}},{"id":"rcr6482wh","name":"h3","children":[{"id":"9yo3jjyxc","name":"title","children":[{"id":"mqhl28esu","name":"text","text":"Ordered List:","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 3","focused":"Heading 3"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"s5tetm2mo","name":"numberList","children":[{"id":"j4wfzihny","name":"title","children":[{"id":"suo0vtkdz","name":"text","text":"First item","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Type \\"/\\" for commands"},"html":{"suppressContentEditableWarning":true,"className":"cnl"}},"remote":{"state":{"listNumber":{},"marks":[]}}}},{"id":"une4skd64","name":"numberList","children":[{"id":"ytuyrra2c","name":"title","children":[{"id":"yc64k2l7u","name":"text","text":"Second item","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}},{"id":"njpso3vi1","name":"numberList","children":[{"id":"h44czcqhi","name":"title","children":[{"id":"cf2mgtzt9","name":"text","text":"Part of Second Item","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Type \\"/\\" for commands"},"html":{"suppressContentEditableWarning":true,"className":"cnl"}},"remote":{"state":{"listNumber":{},"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Type \\"/\\" for commands"},"html":{"suppressContentEditableWarning":true,"className":"cnl"}},"remote":{"state":{"listNumber":{},"marks":[]}}}},{"id":"okouty4vv","name":"numberList","children":[{"id":"l4lt062f5","name":"title","children":[{"id":"brpjqnhny","name":"text","text":"Third item","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Type \\"/\\" for commands"},"html":{"suppressContentEditableWarning":true,"className":"cnl"}},"remote":{"state":{"listNumber":{},"marks":[]}}}},{"id":"8hwbk0nva","name":"h3","children":[{"id":"le73fuhyv","name":"title","children":[{"id":"56p5qya1f","name":"text","text":"Unordered List:","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 3","focused":"Heading 3"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"rmplwdtsp","name":"bulletList","children":[{"id":"bd0a3k9i9","name":"title","children":[{"id":"clnubedzz","name":"text","text":"Easy to us","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"cbl"}},"remote":{"state":{"marks":[]}}}},{"id":"8lcn1jsrq","name":"bulletList","children":[{"id":"kcqikzq7n","name":"title","children":[{"id":"ilnyte57i","name":"text","text":"Customizable","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"cbl"}},"remote":{"state":{"marks":[]}}}},{"id":"x7pr3yna6","name":"bulletList","children":[{"id":"he5e68idr","name":"title","children":[{"id":"rmibvrp16","name":"text","text":"Fast and lightweight","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"List","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"cbl"}},"remote":{"state":{"marks":[]}}}},{"id":"7nxo003np","name":"paragraph","children":[{"id":"6x8p9po9p","name":"title","children":[],"links":{},"props":{"remote":{"state":{"marks":[]}},"local":{"html":{"placeholder":""}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"scoy2ktvm","name":"h3","children":[{"id":"mgu6ob7ql","name":"title","children":[{"id":"_v76os601x","name":"text","text":"Block Quote","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 3","focused":"Heading 3"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"p0x8luans","name":"quote","children":[{"id":"lieyldppx","name":"title","children":[{"id":"lv3wbzfz1","name":"text","text":"\\"The best editors don’t get in your way. They help you express ideas faster.\\"\\n","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}},{"id":"zx66gwsgg","name":"text","text":"— Developer Wisdom","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[{"name":"subscript"}]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Empty quote","focused":""},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"315q6di2t","name":"paragraph","children":[{"id":"mj16x666s","name":"title","children":[],"links":{},"props":{"remote":{"state":{"marks":[]}},"local":{"html":{"placeholder":""}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"uyli3wwl4","name":"h3","children":[{"id":"muaee2k7p","name":"title","children":[{"id":"l82zm25rr","name":"text","text":"Callout","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 3","focused":"Heading 3"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"flo4q2ecl","name":"callout","children":[{"id":"iq11k6oc7","name":"title","children":[{"id":"wa15lr2wh","name":"text","text":"Performance Matters\\n","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[{"name":"bold"}]}}}},{"id":"2oi1jrlie","name":"text","text":"Even with thousands of lines of content, this editor stays snappy thanks to optimized rendering and virtualized DOM updates.","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct","data-focused":true}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Callout","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true,"className":"cbl"}},"remote":{"state":{"marks":[]}}}},{"id":"1xq2kkyqi","name":"paragraph","children":[{"id":"dhevyw17e","name":"title","children":[],"links":{},"props":{"remote":{"state":{"marks":[]}},"local":{"html":{"placeholder":""}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"4kxxaapbi","name":"h3","children":[{"id":"mzad82tnz","name":"title","children":[{"id":"4m600lulf","name":"text","text":"Code block with line highligh","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Heading 3","focused":"Heading 3"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}},{"id":"edd9i37p4","name":"code","children":[{"id":"ggwresxax","name":"title","children":[{"id":"6rx4vtstz","name":"text","text":"function greet(){\\n\\tconsole.log(\\"hello there\\");\\n}","links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"id":"ct"}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Code","focused":"Write some code"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"code":{"theme":"catppuccin-frappe","language":"javascript"},"marks":[]}},"node":{"typeChanged":true}}},{"id":"wyytsf50r","name":"paragraph","children":[{"id":"k6t4zplq0","name":"title","children":[],"links":{},"props":{"remote":{"state":{"marks":[]}},"local":{"html":{"placeholder":""}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"","focused":"Press / for commands"},"html":{"suppressContentEditableWarning":true}},"remote":{"state":{"marks":[]}}}}],"links":{},"props":{"local":{"placeholder":{"empty":"Untitled","focused":"Untitled"},"html":{"className":"cpage","spellCheck":false,"contentEditable":true,"suppressContentEditableWarning":true}},"remote":{"state":{"mode":"edit","marks":[]}}}}],"links":{},"props":{"local":{"html":{"suppressContentEditableWarning":true,"className":"croot"}},"remote":{"state":{"marks":[]}}}}';
const data = JSON.parse(content) as never;

// eslint-disable-next-line @typescript-eslint/ban-ts-comment
// @ts-expect-error
data.id = NodeId.ROOT.toString();

const plugins = [
  ...corePresetPlugins,
  ...blockPresetPlugins,
  ...codemirrorExtension.plugins!,
  ...databasePlugins,
  commentEditorPlugin,

  new BlockMenuPlugin(),
  new ClipboardPlugin(),
];

const renderers = [
  ...blockPresetRenderers,
  ...codemirrorExtension.renderers!,
  ...attrRenderers,
  ...databaseRenderers,
  commentEditorComp,
];

const renderManager = RenderManager.from(renderers);

export function RichText() {
  const app = useCreate(data, plugins, "richtext");

  return (
    <Carbon app={app} renderManager={renderManager}>
      <FloatingStyleMenu />
      <InsertBlockMenu />
    </Carbon>
  );
}
